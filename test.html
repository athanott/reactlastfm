<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Top songs in Greece from LastFM</title>
    <link rel="stylesheet" href="styles/style.css">
    <script src="scripts/react.js"></script>
    <script src="scripts/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.15/browser.js"></script>
    <script src="scripts/jquery.js"></script>
  </head>
  <body>
    <header>
        <h1>Top songs in Greece from LastFM</h1>
    </header>
    <main id="content">
      
    </main>
    <script type="text/babel">
      
      var Grid = React.createClass({
        getSongs: function() {
          jQuery.ajax({
            url: this.props.songs,
            dataType: 'json',
            cache: false,
            success: function(data) {
              this.setState({data: data.tracks.track});
            }.bind(this),
            error: function(xhr, status, err){
              console.error(this.props.data, status, err.toString());
            }.bind(this)
          });
        },
        getInitialState: function() {
          return {data: []};
        },
        componentDidMount: function() {
          this.getSongs();
        },
        render: function(){
          var grid = [];
          this.state.data.forEach(function(track) {
            var rankV = parseInt(track['@attr'].rank) + 1;
            grid.push(<GridItem image={track.image[3]['#text']} rank={rankV} title={track.name} artist={track.artist.name} listeners={track.listeners}/>)
          });
          return (
            <div className="grid">{grid}</div>
          )
        }
      });

      //create GridItem component
      var GridItem = React.createClass({
        render: function(){
          return (
            <div className="grid__item">
              <div className="flipper">
                <FlipperFront image={this.props.image} />
                <FlipperBack rank={this.props.rank} title={this.props.title} artist={this.props.artist} listeners={this.props.listeners}/>
              </div>
            </div>
          )
        }
      });

      //create FlipperFront component
      var FlipperFront = React.createClass({
        render: function(){
          var divStyle = { backgroundImage: 'url(' + this.props.image + ')' };
          return (
            <div className="flipper__front" style={divStyle}></div>
          )
        }
      });

      //create FlipperBack component
      var FlipperBack = React.createClass({
        render: function(){
          return (
            <div className="flipper__back">
              <span className="rank">{this.props.rank}</span>
              <span className="song-title">{this.props.title}</span>
              by&nbsp;<span className="song-artist">{this.props.artist}</span>
              <span className="listeners-count">{this.props.listeners}</span>
            </div>
          )
        }
      });

      ReactDOM.render(
        <Grid songs="http://ws.audioscrobbler.com/2.0/?method=geo.gettoptracks&country=greece&api_key=5fc029712aac633ef33a70014828ac52&format=json" />,
        document.getElementById('content')
      );

    </script>
  </body>
</html>
